name: ci

on:
  workflow_dispatch:
  schedule:
    - cron:  '0 2 * * *'
  push:
    branches: [ "main", "feat/github-actions" ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v4.2.2
      
    - name: Dev Container Build and Run Action
      uses: devcontainers/ci@v0.3
      with:
        imageName: ghcr.io/its3mile/ncsc-caf-scraper-devcontainer
        cacheFrom: ghcr.io/its3mile/ncsc-caf-scraper-devcontainer
        push: never
        runCmd: 
            .venv/bin/python main.py
            
    - run: '[ -f output.json ]'
    
    - run: |
        DATETIME=$(date +"%FT%H%M%S")
        OUTPUT_FILENAME="NCSC-CAF-${DATETIME}.json"
        mv output.json $OUTPUT_FILENAME
        echo $OUTPUT_FILENAME >> $GITHUB_OUTPUT
        
    - uses: actions/upload-artifact@v4
      with:
        name: $OUTPUT_FILENAME
        path: $OUTPUT_FILENAME
